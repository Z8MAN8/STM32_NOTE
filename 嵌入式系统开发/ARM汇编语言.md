# ARM汇编语言

ARM 汇编的应用多集中在 ARM 接口编程及 bootloader ，如 uboot 的移植和修改。

ARM 微处理器的指令集是**加载/存储型**的，即指令集仅能处理寄存器中的数据，而且处理结果都要放回寄存器中。指令集可以分为**跳转指令**、**数据处理指令**、**程序状态寄存器（PSR）处理指令**、**加载/存储指令**、**协处理器指令**和**异常产生**指令六大类。

## 指令的寻址方式

- 立即寻址（前缀 # ）
- 寄存器寻址
- 寄存器间接寻址（ [寄存器] ）
- 基址变址寻址
- 多寄存器寻址
- 相对寻址
- 堆栈寻址（堆栈指针总是指向栈顶）



GNU ARM 汇编中，任何以冒号结尾的都被认为是一个标签，而不一定非要在一行的开始。 @ 是注释



## 混合编程

嵌入式系统的引导系统（BootLoader），包括设备驱动常采用 ARM 汇编和 C 语言混合编程。

内嵌汇编使用的标记是 _asm 或者 asm 关键字。

但也存在一些限制：

- 不能直接向 PC 寄存器赋值，程序跳转要使用 B 或者 BL 指令
- 在使用物理寄存器时，不要使用过于复杂的 C 语言表达式，避免物理寄存器冲突
- R12 和 R13 可能被编译器用来存放中间编译结果，计算表达式值时可能将 R0 到 R3 、R12 及 R14 用于子程序调用，要避免直接使用这些物理寄存器
- 一般不要直接指定物理寄存器，让编译器进行分配

### C 程序中调用汇编的函数实例

1. 在 C 语言中声明函数原型，并加 extern 关键字；
2. 在汇编中用 EXPORT 导出函数名，并用该函数名作为汇编代码段的标识，最后用 mov pc，lr 返回

### 汇编中调用 C 语言的函数实例

1. 在汇编中 IMPORT 对应的 C 语言函数名
2. 将 C 的代码放在一个独立的 C 文件中进行编译



