## STM32—SPI

### 一.什么是SPI

SPI是串行外设接口（Serial Peripheral Interface）的缩写，SPI是一种高速、全双工、同步通信的通信总线，被广泛应用在[ADC](https://so.csdn.net/so/search?q=ADC&spm=1001.2101.3001.7020)、LCD等与MCU的通信过程中，特点就是快。

### 二.SPI协议

SPI的协议，主要分为物理层和协议层。

#### 物理层：

**NSS**：片选设备线，此总线的作用就是为主机选择对应的从机进行传输数据。SPI中规定通信以NSS信号线**拉低为开始，拉高为结束**。

**SCK**：时钟信号线，因为SPI是同步通信，所以需要一根时钟信号线来统一主机和从机之间的数据传输，不同设备支持的最高传输频率可能不一样，在传输过程中**传输频率受限于低速的一方**。

**MOSI**：MOSI就是主机输出/从机输入，因为SPI是全双工的通信总线，即主机和从机可以同时收发数据，这样的话就需要俩条线同时分别负责：主->从和从->主这俩条传输线路。而**MOSI就专门负责主机向从机传输数据**。

**MISO**：MISO专门负责**从机向主机传输数据**。

#### 协议层：

**数据有效性**：SPI中数据的采样是在SCK的**上升沿或下降沿**时进行的。

**通讯模式**：

**时钟极性CPOL**：CPOL是指**NSS总线空闲时SCK的电平信号**，如果SCK为高电平，CPOL=1；SCK为低电平，CPOL=0。下面的这种情况CPOL=0.

**时钟相位CPHA**：CPHA是指数据的采样时刻，SCK的信号可以看作方波，**CPHA=0**时会在SCK的**奇数边沿采样**；**CPHA=1**时会在SCK的**偶数边沿采样**。



### 三.STM32中的SPI

STM32中集成了专门用于SPI通讯的外设。支持最高的 SCK 时钟频率为 fpclk/2
(STM32F103 型号的芯片默认 fpclk1为 72MHz， fpclk2为 36MHz)，完全支持 SPI 协议的 4 种模式，数据帧长度可设置为 8 位或 16 位，可设置数据 MSB 先行或 LSB 先行。它还支持双线全双工、双线单向以及单线模式。其中双线单向模式可以同时使用 MOSI 及 MISO 数据线向一个方向传输数据，可以加快一倍的传输速度。而单线模式则可以减少硬件接线，当然这样速率会受到影响。

##### 详细讲解链接：https://blog.csdn.net/qq_43743762/article/details/98946574

